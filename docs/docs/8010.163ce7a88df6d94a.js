"use strict";(self.webpackChunkmybatboo=self.webpackChunkmybatboo||[]).push([[8010,4650],{8010:(U,v,t)=>{t.r(v),t.d(v,{DiagnosisRequestModalComponent:()=>S});var n=t(5649),C=t(974),u=t(9401),f=t(2704),D=t(9300),M=t(5698),O=t(1135),l=t(8505),x=t(262),c=t(515),h=t(4650),a=t(4657);const p=(0,t(7423).fo)("Geolocation",{web:()=>t.e(4561).then(t.bind(t,4561)).then(g=>new g.GeolocationWeb)});var A=t(4545),e=t(2223),L=t(6814),Z=t(8740),k=t(8615),N=t(5800),I=t(9529),J=t(1757),H=t(7204),y=t(6921),B=t(4755);let S=(()=>{class g extends n.NT{constructor(i,o,s,m,T,P,b,d,E){super(),this.store$=i,this.modalRef=o,this.api=s,this.diagnosisService=m,this.cameraService=T,this.router=P,this.modalService=b,this.toast=d,this.alert=E,this.cropType=new u.NI(null),this.status$=new O.X(n.Lr.INITIAL)}ngOnInit(){this.modalRef.setClass("diagnosis-request-modal"),this.subscribeOn(this.store$.select(f.mC).pipe((0,D.h)(i=>!!i),(0,l.b)(i=>this.cropType.patchValue(i)))),this.geoLocationPromise=p.getCurrentPosition().then(i=>(this.geolocation=i,i))}selectCropType(i){this.cropType.patchValue(i)}close(){this.modalRef.hide()}retakePhoto(){this.close(),this.diagnosisService.startDiagnosis()}request(){const i=({latitude:o,longitude:s})=>{const m="mybatboo_"+(new Date).getTime()+".jpg";this.status$.next(n.Lr.PENDING),this.cameraService.writeFileToDevice(this.cropPhoto.dataUrl,m).then(T=>{this.cameraService.readFileFromDevice(T.fileName).then(P=>{this.api.requestDiagnosis({cropType:this.cropType.value,image:P,geolocation:{latitude:o,longitude:s}}).pipe((0,M.q)(1),(0,l.b)(()=>this.status$.next(n.Lr.FULFILLED)),(0,l.b)(()=>this.store$.dispatch(A.q.setRecentCropType({recentCropType:this.cropType.value}))),(0,l.b)(d=>{this.close(),Promise.all([t.e(5554),t.e(7615),t.e(8592)]).then(t.bind(t,7615)).then(E=>{this.modalService.show(E.DiagnosisResultComponent,{initialState:{diagnosisRecord:d.data}})}),this.cameraService.deleteImageFromDevice(m).then(()=>console.log("image deleted"))}),(0,x.K)(d=>("NOTHING_DETECTED"===d.error?.code||"NOTHING_DETECTED"===d.code?this.alert.alert({title:"\uac80\ucd9c \ub300\uc0c1\uc744 \ucc3e\uc9c0 \ubabb\ud588\uc2b5\ub2c8\ub2e4.",content:"\uc791\ubb3c\uc774 \uc0ac\uc9c4 \uc548\uc5d0 \uc798 \ub4e4\uc5b4\uc624\ub3c4\ub85d \ub2e4\uc2dc \ucd2c\uc601\ud574\uc8fc\uc138\uc694.",closeMessage:"\ud655\uc778",closeButtonColor:"green"}).pipe((0,l.b)(()=>this.close())).subscribe():(this.toast.show(d.message),this.status$.next(n.Lr.REJECTED)),c.E))).subscribe()}).catch(P=>{this.toast.show("\uc774\ubbf8\uc9c0 \ub85c\ub4dc\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4. \ub2e4\uc2dc \uc2dc\ub3c4\ud574\uc8fc\uc138\uc694."),this.status$.next(n.Lr.REJECTED)})}).catch(T=>{this.toast.show("\ucd2c\uc601\ud55c \uc774\ubbf8\uc9c0\ub97c \uac00\uc838\uc624\ub294\ub370 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4. \ub2e4\uc2dc \uc2dc\ub3c4\ud574\uc8fc\uc138\uc694."),this.status$.next(n.Lr.REJECTED)})};if(this.geolocation){const{latitude:o,longitude:s}=this.geolocation.coords;i({latitude:o,longitude:s})}else p.getCurrentPosition().then(o=>{const{latitude:s,longitude:m}=o.coords;i({latitude:s,longitude:m})})}}return g.\u0275fac=function(i){return new(i||g)(e.Y36(L.yh),e.Y36(Z.UZ),e.Y36(k.s),e.Y36(N.r),e.Y36(I.y),e.Y36(J.F0),e.Y36(Z.tT),e.Y36(H.k),e.Y36(y.c9))},g.\u0275cmp=e.Xpm({type:g,selectors:[["app-diagnosis-request-modal"]],inputs:{cropPhoto:"cropPhoto"},standalone:!0,features:[e.qOj,e.jDz],decls:22,vars:26,consts:[["height","64px",3,"title"],["left","",1,"back-button",3,"click"],["name","chevron_left","color","green","size","28px"],[1,"image-preview"],["alt","crop-image",3,"src"],[1,"crop-type-selector"],["label","\uace0\ucd94",3,"variant","color","click"],["left","","src","/assets/images/pepper.png","alt","",1,"crop-icon-img"],["label","\ub538\uae30",3,"variant","color","click"],["left","","src","/assets/images/strawberry.png","alt","",1,"crop-icon-img"],["label","\uc0c1\ucd94",3,"variant","color","click"],["left","","src","/assets/images/lettuce.png","alt","",1,"crop-icon-img"],["label","\ud1a0\ub9c8\ud1a0",3,"variant","color","click"],["left","","src","/assets/images/tomato.png","alt","",1,"crop-icon-img"],["height","81px"],["label","\ub2e4\uc2dc \ucd2c\uc601\ud558\uae30","variant","weak","color","red","size","m",3,"click"],["left","","name","undo"],["label","\uc9c4\ub2e8 \uc2dc\uc791","variant","weak","color","greenDark","size","m",3,"disabled","loading","click"],["left","","name","send"]],template:function(i,o){1&i&&(e.TgZ(0,"page-header",0)(1,"div",1),e.NdJ("click",function(){return o.close()}),e._UZ(2,"mp-icon",2),e.TgZ(3,"span"),e._uU(4,"Back"),e.qZA()()(),e.TgZ(5,"div",3),e._UZ(6,"img",4),e.qZA(),e.TgZ(7,"div",5)(8,"mp-button",6),e.NdJ("click",function(){return o.selectCropType(0)}),e._UZ(9,"img",7),e.qZA(),e.TgZ(10,"mp-button",8),e.NdJ("click",function(){return o.selectCropType(1)}),e._UZ(11,"img",9),e.qZA(),e.TgZ(12,"mp-button",10),e.NdJ("click",function(){return o.selectCropType(2)}),e._UZ(13,"img",11),e.qZA(),e.TgZ(14,"mp-button",12),e.NdJ("click",function(){return o.selectCropType(3)}),e._UZ(15,"img",13),e.qZA()(),e.TgZ(16,"bottom-fixed-bar",14)(17,"mp-button",15),e.NdJ("click",function(){return o.retakePhoto()}),e._UZ(18,"mp-icon",16),e.qZA(),e.TgZ(19,"mp-button",17),e.NdJ("click",function(){return o.request()}),e.ALo(20,"async"),e._UZ(21,"mp-icon",18),e.qZA()()),2&i&&(e.Q6J("title","\uc9c4\ub2e8 \uc694\uccad"),e.xp6(6),e.Q6J("src",o.cropPhoto.dataUrl,e.LSH),e.xp6(2),e.Udp("border",0===o.cropType.value?"1px solid var(--green)":"1px solid var(--grayLight)"),e.Q6J("variant",0===o.cropType.value?"weak":"void")("color",0===o.cropType.value?"greenDark":"grayDark"),e.xp6(2),e.Udp("border",1===o.cropType.value?"1px solid var(--green)":"1px solid var(--grayLight)"),e.Q6J("variant",1===o.cropType.value?"weak":"void")("color",1===o.cropType.value?"greenDark":"grayDark"),e.xp6(2),e.Udp("border",2===o.cropType.value?"1px solid var(--green)":"1px solid var(--grayLight)"),e.Q6J("variant",2===o.cropType.value?"weak":"void")("color",2===o.cropType.value?"greenDark":"grayDark"),e.xp6(2),e.Udp("border",3===o.cropType.value?"1px solid var(--green)":"1px solid var(--grayLight)"),e.Q6J("variant",3===o.cropType.value?"weak":"void")("color",3===o.cropType.value?"greenDark":"grayDark"),e.xp6(3),e.Udp("border","1px solid var(--redLight)"),e.xp6(2),e.Udp("border","1px solid var(--green)"),e.Q6J("disabled",!o.cropType.value&&0!==o.cropType.value)("loading",e.lcZ(20,24,o.status$).pending))},dependencies:[C.B,y.zJ,y.gL,y.k_,B.Ov,h.q,a.N],styles:['@charset "UTF-8";  .modal-dialog.diagnosis-request-modal{max-width:100vw;max-height:var(--full-height);margin:0}  .modal-dialog.diagnosis-request-modal .modal-content{display:block;border-radius:0;width:100vw;height:var(--full-height);margin:0}[_nghost-%COMP%]   page-header[_ngcontent-%COMP%]{box-shadow:inset 0 -1px #0000001f}[_nghost-%COMP%]   page-header[_ngcontent-%COMP%]   .back-button[_ngcontent-%COMP%]{display:flex;align-items:center;font-size:18px;color:var(--green);font-weight:500}[_nghost-%COMP%]   .image-preview[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;box-shadow:inset 0 -1px #0000001f}[_nghost-%COMP%]   .image-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;aspect-ratio:1/1}[_nghost-%COMP%]   .crop-type-selector[_ngcontent-%COMP%]{padding:24px;display:grid;grid-template-columns:repeat(2,1fr);grid-column-gap:16px;grid-row-gap:16px}[_nghost-%COMP%]   .crop-type-selector[_ngcontent-%COMP%]   .crop-icon-img[_ngcontent-%COMP%]{width:36px;height:36px}[_nghost-%COMP%]   .crop-type-selector[_ngcontent-%COMP%]   mp-button.selected[_ngcontent-%COMP%]{border:1px solid var(--green)}[_nghost-%COMP%]   bottom-fixed-bar[_ngcontent-%COMP%]{padding:12px 24px;display:flex;justify-content:space-between;align-items:center;gap:16px}[_nghost-%COMP%]   bottom-fixed-bar[_ngcontent-%COMP%]   mp-button[_ngcontent-%COMP%]{flex:1}']}),g})()},4650:(U,v,t)=>{t.d(v,{q:()=>x});var n=t(2223),C=t(4755),u=t(5649),f=t(6921),D=t(974);const M=["titleDiv"],O=[[["","left",""]],[["mp-text","center",""]],[["",8,"center"]],[["","right",""]],[["",8,"actions"]]],l=["[left]","mp-text[center]",".center","[right]",".actions"];let x=(()=>{class c extends u.NT{constructor(a,r,p){super(),this.platformId=a,this.elementRef=r,this.renderer=p,this.backgroundColor="white"}get parentElement(){return this.elementRef.nativeElement.parentElement}ngOnInit(){if(!this.height)throw new Error("page-header\uc5d0 height \uc778\ud48b\uc744 \ubb34\uc870\uac74 \ub123\uc5b4\uc918\uc57c\ud569\ub2c8\ub2e4.");this.subscribeOn((0,u.oi)(this,this.renderer,this.elementRef.nativeElement,{"--text-color":({titleColor:a})=>f.u$.parse(a),"--page-header-background":({backgroundColor:a})=>f.u$.parse(a)}))}ngAfterViewInit(){(0,C.NF)(this.platformId)&&(this._backupHeight=getComputedStyle(this.parentElement).getPropertyValue("--page-header-height")),this.subscribeOn((0,u.oi)(this,this.renderer,this.parentElement,{"--page-header-height":({height:a})=>a}))}ngOnDestroy(){super.ngOnDestroy(),(0,C.NF)(this.platformId)&&(this._backupHeight?this.renderer.setStyle(this.parentElement,"--page-header-height",this._backupHeight,n.JOm.DashCase):this.renderer.removeStyle(this.parentElement,"--page-header-height",n.JOm.DashCase))}}return c.\u0275fac=function(a){return new(a||c)(n.Y36(n.Lbi),n.Y36(n.SBq),n.Y36(n.Qsj))},c.\u0275cmp=n.Xpm({type:c,selectors:[["page-header"],["top-panel"]],viewQuery:function(a,r){if(1&a&&n.Gf(M,5),2&a){let p;n.iGM(p=n.CRH())&&(r.titleElement=p.first)}},hostVars:2,hostBindings:function(a,r){2&a&&n.Udp("padding",r.padding)},inputs:{title:"title",height:"height",titleColor:"titleColor",padding:"padding",backgroundColor:"backgroundColor"},standalone:!0,features:[n.qOj,n.jDz],ngContentSelectors:l,decls:11,vars:1,consts:[[1,"flex"],[1,"left-container"],[1,"center","title"],["titleDiv",""],[1,"right-container"]],template:function(a,r){1&a&&(n.F$t(O),n.TgZ(0,"div",0)(1,"div",1),n.Hsn(2),n.qZA(),n.TgZ(3,"div",2,3),n._uU(5),n.Hsn(6,1),n.Hsn(7,2),n.qZA(),n.TgZ(8,"div",4),n.Hsn(9,3),n.qZA()(),n.Hsn(10,4)),2&a&&(n.xp6(5),n.hij(" ",r.title," "))},dependencies:[D.B],styles:['@charset "UTF-8";[_nghost-%COMP%]{width:100%;display:flex;flex-direction:column;padding:14px;background-color:var(--page-header-background-important, var(--page-header-background))}.is-modal[_nghost-%COMP%]{border-top-right-radius:14px;border-top-left-radius:14px}.tab-bar-hidden.header-hidden[_nghost-%COMP%], .tab-bar-hidden.header-hidden   [_nghost-%COMP%]{transform:translateY(0)}.flex[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%;margin:auto 0}.flex[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{flex:1}.flex[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%], .flex[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]     .center{overflow:hidden;text-overflow:ellipsis;flex:1.5;text-align:center;font-size:14px;font-weight:500;line-height:1.58;color:var(--text-color, var(--grayDark));white-space:nowrap}.flex[_ngcontent-%COMP%]   .left-container[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;align-items:center}.flex[_ngcontent-%COMP%]   .right-container[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;padding:0 4px 0 0}.flex[_ngcontent-%COMP%]    +.actions{width:100%;margin-top:12px}']}),c})()}}]);